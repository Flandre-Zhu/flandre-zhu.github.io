# Atcoder Regular Contest 118 比赛记录 (vp)

赛时: ABC

赛后: ABCD

## 题解

AB略

C: 先搞一个6,10,15,然后在16~10000之间找那些在 $2,3,5$ 中含有其中至少两个的数。这样的数约有2600个，它们整体的gcd显然为0，并且任取两个，都会在 $2,3,5$ 中有至少一个作为gcd，那就 $>1$ 了。

D: 套路地，先搞一个原根出来，然后求出 $a,b$ 的阶，乘法变加法。

现在相当于是，有一个 $a,b$，然后写一堆不同的 $(x,y)$，满足：相邻的 $(x,y)$ 只会在其中一维上相差 $1$，而另一维相同，且所有的 $ax+by$ 遍历 $0...p-2$ 中的所有数。

> 引入一个经典结论 
> 
> 对于一个数，咱给它一直加 $a$ 模 $m$，如果把走过的路径建出一个图，会形成一个环。这一个环不一定覆盖所有 $m$ 个点，但我们可以把 $m$ 个点分解成若干个环，每个环里的数之间都可以不断的 $+a$ 来得到。
> 
> 比如 $m=10,a=4$，可以分解成 $2$ 个环，两个环分别是 $(0,4,8,2,6),(1,5,9,3,7)$
>
> 这个经典结论是，我们会分解出 $\gcd(a,m)$ 个环，每个环长度为 $\dfrac{m}{gcd(a,m)}$。可以用bezult定理等东西证出来。
> 
> 有一个扩展结论，就是如何判定每个数在哪个环里。假设环从 $0$ 编号到 $\gcd(a,m)-1$，其中 $i$ 编号的环里包含 $i$ 这个数。显然，在一个环里的数，显然是 $(k+ax)\mod m$ 的形式。$\mod m$ 可以看成 $+my$。那就是 $k+(ax+my)$。根据bezult定理，这个东西等价于 $k+x\times \gcd(a,m)$。然后我们把每个数 $x$ 模一个 $\gcd(a,m)$，得到一个 $y$，那说明 $x$ 和 $y$ 在一个环里。显然 $y\in[0,\gcd(a,m)-1]$。根据环编号的定义，显然这个 $y$，也就是 $x\mod \gcd(a,m)$，就是 $x$ 所在的环的编号。

现在我们是不断的 $\pm a$ 或者 $\pm b$。首先我们要取遍所有数，那么根据bezult定理， $\gcd(a,b,p-1)=1$，不满足就无解。先判掉这个情况，接下来假设这个东西成立。

然后咱可以把两组环分解搞出来，然后不断的手玩。

> 赛场上我到这一步，没有玩出来

设两个环长为 $l_a,l_b$。$l_a=\dfrac{p-1}{\gcd(p-1,a)},l_b=\dfrac{p-1}{\gcd(p-1,b)}$。

那么 $l_a\times l_b$ 为 $p-1$ 的倍数，容易发现。

> 如何发现？我们把每个数字的质因子看成多重集，那么 $\gcd$ 相当于集合取交，除相当于取补集。假设 $B\subset A$，用 $A/B$ 表示 $B$ 在 $A$ 中的补集，或者叫“A排除B后剩下的”。
> 
> 设 $A,B,C$ 分别为 $a,b,p-1$ 代表的这个集合。只需要证明 $(C/(A\cap C))+(C/(B\cap C))$ 是 $C$ 的超集就行。然后你画个韦恩图就结束了。 
>
> 这个证明很简单，但是这个用韦恩图表示东西的方法很有用。后面可能会 “显然” 几个结论，大多是用这个思路证，或者辅助观察的。

在模 $p-1$ 意义下，对于一个 $ax+by$，显然我们可以把 $x$ 模上一个 $l_a$，$y$ 模上一个 $l_b$，不改变它的值。

然后是一个妙妙结论：对于所有的 $x\in[0,l_a-1],y\in[0,l_b-1]$，我们把 $ax+by$ 都写出来，那么 $0...p-2$ 中的每个数恰好出现 $\dfrac{l_al_b}{p-1}$ 次。

可以感性理解它的正确性，也可以一波数学分析证明它。这里给出感性理解：注意到环的分布，非常的均匀，并且“环”这个结构对于每个点是对称的。这里相当于把两个环叉起来，想想这个互补的过程，然后发现它得到的结果好像也非常均匀，因此每个数出现次数都一样。总共显然是 $l_al_b$ 次，一共 $p-1$ 个数，因此得到这个结论。

注意到 $a,b$ 没有本质区别，且 $l_a,l_b$ 中一定有一个是偶数（$p-1$是偶数，它俩乘起来是 $p-1$ 的倍数，那肯定有一个偶数）。不妨设 $l_a$ 是偶数。

那我们设 $l'=\dfrac{p-1}{l_a}=\gcd(a,p-1)$，把 $ax+by,\ x\in[0,l_a-1],\ y\in[0,l'-1]$ 写出来，是否能恰好遍历每个数一次呢？

这是对的！可以证明，如下

> 证明：注意到这里的 $l'$ 就是环个数。
> 
> 然后这件事情相当于，考虑 $a$ 构成的那一堆环，我们在包含 $0$ 的那个环上走，走的过程中还 “节外生枝”，加若干个 $b$，跑到别的环上去。接下来只要证明，对于 $0$ 的那个环上的任意数，也就是 $ax$，它加 $[0...l'-1]$ 个 $b$ 是否能恰好走完所有的环。
> 
> 恰好走完所有环，也就是把所有编号访问一遍。也就是说，$ax,ax+b,ax+2b...ax+(l'-1)b$ 它们模 $l'$ 的余数两两不同。
>
> $ax$ 是公有的，可以消去，那也就是说 $0,b,2b,3b...(l'-1)b$ 模 $l'$ 的余数两两不同。再一分析，这等价于，$b$ 和 $l'$ 互质。根据刚才的结论，只有 $\gcd(a,b,p-1)=1$ 时有解。即，此时 $\gcd(b,\gcd(a,p-1))=1$，也就等价于 $\gcd(b,l')=1$。对！太对了
>
> 不断等价回去，我们得到，在 $\gcd(a,b,p-1)=1$ 时，$ax+by,\ x\in[0,l_a-1],\ y\in[0,l'-1]$ 可以遍历 $0...p-2$ 中的每个数一次。

然后就是构造环节。说了这个结论有啥用呢？

我们把每个 $ax+by$ 看成网格图上的点 $(x,y)$。设这个网格是循环的，即，第一行和最后一行相邻，第一列和最后一列相邻（因为取模）。这个网格有 $l_a$ 行，$l'=\dfrac{p-1}{l_a}$ 列。然后我们相当于要在网格上走哈密顿路。

注意到这个网格有偶数行。我们可以按照如下方法构造一个哈密顿路：（图 from 官方题解）

![](https://img.atcoder.jp/arc118/0c78a06b4ca6e3a1f5120c86bb8ced1c.png)

总结:
- 常见技巧: 偶数面积网格图的哈密顿回路构造
- 对于两个东西 $a,b$，涉及到 $ax+by$ 如何如何，可以转化成网格图，是一个常见套路
  

## 实况

A,B,C 比较简单，比ARC128那一场简单多了，比较轻松过了。

这个D非常困难！不过我状态调整的比较好，没有睡着。我想起来xay5421说要多手玩，玩一玩就会了（可能他比较会玩，我不会呜呜呜），我就非常积极的在瞎jb试。最后，由于我的智商不过关，我没玩出来

后来想了一波发现我是没接触过网格图的哈密顿路，因此我没往那边想。。

## 后记: 和nealchen的交流

nealchen | E.Space粉丝应援团 18:19:38
做完了。

> 好强啊，这就是nealchen吗 /se/se/se


nealchen | E.Space粉丝应援团 18:20:25
![](https://flandre-zhu.github.io/zhu/contests/nealchen.jpg)

nealchen | E.Space粉丝应援团 18:20:32
草稿纸全貌一览

nealchen | E.Space粉丝应援团 18:21:15
听说你要知道我怎么玩的

nealchen | E.Space粉丝应援团 18:22:20
这个题其实无聊，一开始就朦胧看出网格结构了

nealchen | E.Space粉丝应援团 18:22:41
网格图的哈密顿回路又是经典结论

> 我不会呜呜呜

nealchen | E.Space粉丝应援团 18:23:16
你看出网格来，就做完了

nealchen | E.Space粉丝应援团 18:45:44
其实我到网格图那里的思路是发生了回旋的

nealchen | E.Space粉丝应援团 18:46:02
因为一边长度为1的情况是要绕环

nealchen | E.Space粉丝应援团 18:46:53
在我构思怎么扩展这一结论，也就是风骚地绕环的时候，网格图这一结构可能会被忽视

> 确实需要考虑每一种可能的思路，并逐个尝试；我个人会把每个思路都记下来

nealchen | E.Space粉丝应援团 18:47:35
这时候得丢弃掉这些回旋的边

